# LangGraph 학습 내용 정리

## 1. LangGraph란 무엇인가?

### 정의
**LangGraph**는 **장기 실행되는 상태 기반(stateful) AI 에이전트와 워크플로를 구축, 관리, 배포**하기 위한 저수준(low-level) 오케스트레이션 프레임워크이다. LangChain 생태계의 일부로, 복잡한 에이전트 시스템을 **그래프(Graph) 구조**로 모델링할 수 있다.

### 왜 LangGraph가 필요한가?

전통적인 LLM 애플리케이션은 단순한 선형 흐름으로 작동한다:
```
입력 → LLM 호출 → 출력
```

하지만 실제 복잡한 작업은 다음이 필요하다:
- **조건부 분기**: 상황에 따라 다른 경로 선택
- **반복 실행**: 결과가 만족스러울 때까지 재시도
- **상태 유지**: 이전 대화와 결정 기억
- **병렬 처리**: 여러 작업을 동시에 수행
- **인간 개입**: 중요한 결정에 사람의 검토 필요

LangGraph는 이러한 복잡한 패턴을 **그래프의 노드(nodes)와 엣지(edges)**로 표현할 수 있다.

---

## 2. LangGraph의 핵심 특징

### 2.1 Stateful Agents (상태 기반 에이전트)
에이전트가 대화 기록, 중간 결과, 컨텍스트를 **지속적으로 유지**할 수 있다.

```python
class MessagesState(TypedDict):
    messages: list[BaseMessage]  # 대화 기록 유지
    last_active_agent: str        # 현재 활성 에이전트 추적
```

### 2.2 Durable Execution (내구성 있는 실행)
- 실패 시 자동으로 **정확히 중단된 지점부터 재개**
- 장시간 실행되는 작업도 안정적으로 처리
- 세션 간 상태 보존

### 2.3 Human-in-the-Loop (인간 개입)
- 에이전트 실행 중 **언제든지 일시 중지**하고 사람의 검토 요청
- 상태 검사 및 수정 가능
- 승인 후 원활하게 실행 재개

```python
def human_node(state: MultiAgentState) -> Command:
    """사용자 입력을 수집하는 노드"""
    user_input = interrupt(value="Ready for user input.")
    return Command(update={"messages": [{"role": "human", "content": user_input}]})
```

### 2.4 Comprehensive Memory (포괄적 메모리)
- **단기 메모리**: 현재 추론에 필요한 작업 메모리
- **장기 메모리**: 세션 간 지속되는 영속적 메모리

---

## 3. Multi-Agent 시스템에서 LangGraph의 역할

### 3.1 왜 Multi-Agent인가?

단일 에이전트의 한계:
- 너무 많은 도구를 관리하면 **의사결정 품질 저하**
- 컨텍스트가 너무 복잡하면 **추적 어려움**
- 모든 작업을 하나의 에이전트가 처리하면 **확장성 문제**

Multi-Agent 시스템의 장점:
- **모듈성(Modularity)**: 개별 에이전트를 독립적으로 개발/테스트/유지보수
- **전문화(Specialization)**: 특정 도메인에 특화된 전문가 에이전트
- **제어(Control)**: 에이전트 간 통신을 명시적으로 제어

### 3.2 LangGraph의 역할

LangGraph는 Multi-Agent 시스템에서 **오케스트레이터(지휘자)** 역할을 할 수 있다:

1. **에이전트 정의**: 각 에이전트를 그래프의 **노드(Node)**로 정의
2. **흐름 제어**: 에이전트 간 전환을 **엣지(Edge)**로 정의
3. **상태 관리**: 모든 에이전트가 공유하는 **중앙 상태(State)** 유지
4. **협업 조율**: 에이전트 간 **핸드오프(Handoff)**와 **메시지 전달** 관리

---

## 4. Multi-Agent 아키텍처 패턴

### 4.1 Network 패턴 (네트워크)
**모든 에이전트가 서로 통신 가능**, 각 에이전트가 다음 호출할 에이전트를 결정할 수 있다.

```
┌─────────────┐
│   Agent A   │◄──┐
└──────┬──────┘   │
       │          │
       ▼          │
┌─────────────┐   │
│   Agent B   │───┘
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Agent C   │
└─────────────┘
```

**장점**: 유연성, 동적 라우팅
**단점**: 복잡도 증가

**구현 예시 (Python)**:
```python
from langgraph.graph import StateGraph, START, MessagesState
from langgraph.prebuilt import create_react_agent

# 에이전트 간 핸드오프 도구 정의
def create_handoff_tool(agent_name: str, description: str):
    @tool
    def transfer_to_agent() -> Command:
        return Command(goto=agent_name, graph=Command.PARENT)
    return transfer_to_agent

# 각 에이전트가 다른 에이전트로 전환 가능한 도구 보유
flight_assistant = create_react_agent(
    model="anthropic:claude-3-5-sonnet-latest",
    tools=[book_flight, transfer_to_hotel_assistant],
    name="flight_assistant"
)

hotel_assistant = create_react_agent(
    model="anthropic:claude-3-5-sonnet-latest",
    tools=[book_hotel, transfer_to_flight_assistant],
    name="hotel_assistant"
)

# 그래프 구성
multi_agent_graph = (
    StateGraph(MessagesState)
    .add_node(flight_assistant)
    .add_node(hotel_assistant)
    .add_edge(START, "flight_assistant")
    .compile()
)
```

### 4.2 Supervisor 패턴 (감독자)
**중앙 감독자 에이전트**가 모든 작업을 조율하고, 작업자 에이전트에게 작업 할당

```
        ┌─────────────┐
        │ Supervisor  │
        └──────┬──────┘
               │
       ┌───────┼───────┐
       │       │       │
       ▼       ▼       ▼
   ┌─────┐ ┌─────┐ ┌─────┐
   │ Wkr │ │ Wkr │ │ Wkr │
   │  A  │ │  B  │ │  C  │
   └─────┘ └─────┘ └─────┘
```

**장점**: 명확한 제어, 관리 용이
**단점**: 감독자가 병목점이 될 수 있음

**구현 예시 (Python)**:
```python
from langgraph_supervisor import create_supervisor

# 전문화된 에이전트 생성
research_agent = create_react_agent(
    model="gpt-4o",
    tools=[tavily_search],
    prompt="You are a research specialist."
)

math_agent = create_react_agent(
    model="gpt-4o",
    tools=[calculator, symbolic_math],
    prompt="You are a math specialist."
)

# 감독자 생성
supervisor = create_supervisor(
    agents=[research_agent, math_agent],
    model=ChatOpenAI(model="gpt-4o"),
    prompt="You manage research and math agents. Assign work appropriately."
).compile()
```

### 4.3 Swarm 패턴 (스웜)
에이전트들이 **자율적으로 협업**하며, 필요시 서로에게 작업 전달

```python
from langgraph_swarm import create_swarm, create_handoff_tool

swarm = create_swarm(
    agents=[flight_assistant, hotel_assistant],
    default_active_agent="flight_assistant"
).compile()
```

### 4.4 Hierarchical 패턴 (계층적)
**여러 레벨의 에이전트 계층 구조**, 서브그래프를 포함한 복잡한 시스템

---

## 5. 실용 가이드

### 5.1 시작하기

**설치**:
```bash
# Python
pip install langgraph langchain-anthropic

# JavaScript/TypeScript
npm install @langchain/langgraph
```

**첫 번째 Multi-Agent 시스템**:
```python
from langgraph.graph import StateGraph, MessagesState, START
from langgraph.prebuilt import create_react_agent
from langchain_anthropic import ChatAnthropic

# 1. 에이전트 도구 정의
@tool
def book_flight(from_airport: str, to_airport: str):
    """항공편 예약"""
    return f"Successfully booked flight from {from_airport} to {to_airport}"

# 2. 에이전트 생성
flight_agent = create_react_agent(
    model=ChatAnthropic(model="claude-3-5-sonnet-latest"),
    tools=[book_flight],
    prompt="You are a flight booking assistant"
)

# 3. 그래프 구성
graph = (
    StateGraph(MessagesState)
    .add_node("flight_agent", flight_agent)
    .add_edge(START, "flight_agent")
    .compile()
)

# 4. 실행
result = graph.invoke({
    "messages": [{"role": "user", "content": "Book a flight from BOS to JFK"}]
})
```

### 5.2 학습 리소스

**공식 문서**:
- [LangGraph 공식 문서](https://langchain-ai.github.io/langgraph/)
- [LangGraph GitHub](https://github.com/langchain-ai/langgraph)
- [LangChain Academy](https://academy.langchain.com/) - 무료 구조화된 강좌

**튜토리얼**:
- [Multi-Agent Supervisor 튜토리얼](https://langchain-ai.github.io/langgraph/tutorials/multi_agent/agent_supervisor/)
- [Multi-Agent Collaboration 튜토리얼](https://langchain-ai.github.io/langgraph/tutorials/multi_agent/multi-agent-collaboration/)

### 5.3 중요 참고 사항

**LangGraph v1.0 릴리스 완료** (2025년 10월 17일)
- Python 3.10 이상 필요 (Python 3.9 지원 종료)
- 완전한 하위 호환성 유지 (backward compatibility)
- 구버전 문서 일부 deprecated
- 안정성 보장: 2.0 이전까지 breaking changes 없음


---

## 핵심 요약

| 항목 | 내용 |
|------|------|
| **LangGraph란?** | 상태 기반 AI 에이전트를 그래프로 구축하는 프레임워크 |
| **핵심 특징** | Stateful, Durable, Human-in-the-loop, Comprehensive Memory |
| **Multi-Agent 역할** | 에이전트 오케스트레이션, 흐름 제어, 상태 관리, 협업 조율 |
| **주요 패턴** | Network, Supervisor, Swarm, Hierarchical |
| **사용 이유** | 복잡한 AI 워크플로의 모듈화, 전문화, 제어 |
