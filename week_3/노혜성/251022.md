# 크롬 확장프로그램 개발 가이드

## 1. 개요

크롬 확장프로그램은 HTML, CSS, JavaScript를 사용하여 웹 브라우저 기능을 확장하는 소프트웨어 모듈입니다. Chrome Web Store를 통해 배포되며, Manifest V3가 현재 표준입니다.

**주요 특징:**
- 브라우저 UI 커스터마이징, 웹페이지 내용 수정
- Chrome API를 통한 브라우저 기능 접근
- 크로스 플랫폼 지원 (Windows, Mac, Linux, ChromeOS)

**Manifest V3:** 보안 강화, 성능 개선, 개인정보 보호 중심 설계 (V2는 단계적 폐지)

## 2. 매니페스트 파일 (manifest.json)

확장프로그램의 핵심 설정 파일로 모든 확장프로그램에 필수입니다.

**필수 필드:**
- manifest_version: 버전 (3 권장)
- name: 확장프로그램 이름
- version: 버전 번호

**주요 선택 필드:**
- description, icons (16x16, 32x32, 48x48, 128x128)
- permissions: 권한 목록
- action: 툴바 버튼 설정 (V3)
- background: 백그라운드 스크립트
- content_scripts: 웹페이지 주입 스크립트

## 3. 핵심 구성요소

### 3.1 팝업 (Popup)
확장프로그램 아이콘 클릭 시 표시되는 HTML 페이지

**특징:** 독립적인 HTML/CSS/JS 사용, 일시적 UI (닫으면 상태 초기화), 사용자 상호작용 지점
**용도:** 사용자 설정, 정보 표시, 기능 제어

### 3.2 콘텐츠 스크립트 (Content Scripts)
웹페이지 컨텍스트에서 실행되는 JavaScript

**특징:**
- 페이지 DOM 직접 접근 가능, 격리된 실행 환경 (isolated world)
- 페이지 JavaScript 변수 직접 접근 불가, URL 패턴에 자동 주입 가능

**주입 방식:** 정적 (manifest.json 선언) / 동적 (chrome.scripting API)
**주입 타이밍:** document_start (DOM 생성 전) / document_end (DOM 완료, 기본값) / document_idle (페이지 로드 완료)
**용도:** 웹페이지 수정, DOM 조작, 데이터 수집, 사용자 상호작용 감지

### 3.3 백그라운드 스크립트 / 서비스 워커 (Service Workers)
백그라운드에서 실행되는 이벤트 기반 스크립트

**Manifest V3 변화:** 지속적 백그라운드 페이지 → 이벤트 기반 서비스 워커

**특징:**
- 웹페이지/팝업 종료 후에도 실행 가능, 이벤트 발생 시만 활성화 (리소스 효율)
- DOM 접근 불가, 모든 Chrome API 접근 가능

**생명주기:** 설치 시 활성화 → 이벤트 대기 → 이벤트 발생 시 활성화 → 작업 완료 후 비활성화 (약 30초)
**용도:** 장기 실행 작업, 브라우저 이벤트 리스닝, 구성요소 간 통신 중재, 데이터 저장, API 호출

### 3.4 구성요소 간 통신

**메시지 패싱:**
- chrome.runtime.sendMessage (일회성)
- chrome.runtime.onMessage (수신 리스너)
- chrome.runtime.connect (지속 연결)

**스토리지:**
- chrome.storage.local (로컬)
- chrome.storage.sync (동기화, Google 계정 연동)
- chrome.storage.session (세션, V3)

## 4. 권한 시스템

확장프로그램이 접근할 수 있는 기능과 데이터 제어

**권한 유형:**
- permissions: 설치 시 필수, 거부 시 설치 불가
- optional_permissions: 런타임 동적 요청 가능
- host_permissions (V3): 특정 웹사이트 접근, URL 패턴 정의

**주요 권한:**
- activeTab (현재 활성 탭 임시 접근), tabs (탭 정보), storage (데이터 저장)
- scripting (스크립트 주입, V3), webRequest (네트워크 요청), notifications (알림)
- contextMenus (컨텍스트 메뉴)

**최소 권한 원칙:** 필요 최소 권한만 요청하여 사용자 신뢰 확보 및 보안 위험 감소

## 5. 개발 워크플로우

### 프로젝트 구조
- manifest.json (필수)
- icons/ (아이콘), popup/ (팝업), content/ (콘텐츠 스크립트)
- background/ (서비스 워커), styles/ (CSS)

### 개발 환경 설정
1. chrome://extensions/ 접속 → 개발자 모드 활성화
2. "압축해제된 확장 프로그램을 로드합니다" → 프로젝트 폴더 선택

**핫 리로딩:** 코드 수정 후 확장프로그램 새로고침 (서비스 워커 자동 재시작, 콘텐츠 스크립트는 페이지 새로고침 필요)

### 디버깅
- **팝업:** 우클릭 → 검사, DevTools 사용
- **콘텐츠 스크립트:** 웹페이지 F12, Sources 탭 확인
- **서비스 워커:** chrome://extensions/에서 "서비스 워커" 링크, DevTools 활용

**버전 관리:** Semantic Versioning (major.minor.patch), manifest.json의 version 업데이트

## 6. 디버깅 및 테스트

### 일반 문제 해결
- **서비스 워커 비활성화:** 이벤트 리스너 최상위 등록, chrome.alarms로 주기 작업
- **콘텐츠 스크립트 주입 실패:** matches 패턴 확인, 권한 검토, run_at 타이밍 조정
- **CORS 에러:** 서비스 워커에서 fetch, host_permissions 추가

**로깅:** console.log/error, chrome.runtime.lastError 체크

## 7. 배포 및 출시

### Chrome Web Store 게시 준비
**필수 자료:** ZIP 파일, 128x128 아이콘, 스크린샷 (1280x800 또는 640x400), 상세 설명, 개인정보처리방침 (데이터 수집 시)
**개발자 계정:** Chrome Web Store Developer Dashboard, 일회성 등록 비용 ($5)

### 출시 프로세스
1. 패키징 (ZIP 압축) → 2. Developer Dashboard 업로드
3. 정보 입력 (이름, 설명, 카테고리, 스크린샷)
4. 심사 제출 (Google 자동/수동 심사) → 5. 승인 후 공개

**심사 기준:** Program Policies 준수, 단일 목적 원칙, 최소 권한, 명확한 개인정보처리방침, 악성 코드 부재

**업데이트:** 버전 증가, 변경사항 기록, 단계적 출시 가능, 피드백 모니터링
**베타 테스트:** 제한된 사용자 배포 → 피드백 수집 → 정식 출시

## 8. 보안 및 모범 사례

### 보안
- 원격 코드 실행 금지 (V3 엄격 제한), eval()/inline script 자제
- CSP 준수, 사용자 데이터 암호화, HTTPS 사용

### 성능
- 서비스 워커 이벤트 기반 설계, 불필요한 권한 제거
- 콘텐츠 스크립트 최소화, 리소스 지연 로딩

### 사용자 경험
- 명확한 UI/UX, 빠른 응답, 유용한 에러 메시지, 오프라인 지원 고려

## 9. 유용한 Chrome APIs

- **chrome.tabs:** 탭 관리/조작
- **chrome.storage:** 데이터 저장/동기화
- **chrome.runtime:** 생명주기 관리
- **chrome.scripting:** 스크립트 동적 주입 (V3)
- **chrome.action:** 툴바 버튼 제어 (V3)
- **chrome.alarms:** 주기 작업 스케줄링
- **chrome.notifications:** 시스템 알림
- **chrome.contextMenus:** 컨텍스트 메뉴
- **chrome.webRequest:** 네트워크 요청 모니터링
- **chrome.bookmarks:** 북마크 접근
