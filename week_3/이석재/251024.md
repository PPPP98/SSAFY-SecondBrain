IL: Spring Boot와 Neo4j 관계 설정 핵심 정리

1. 기본 용어 이해
Neo4j는 RDB와 용어가 다름

Node는 데이터 (RDB의 Row)

Label은 노드 그룹 (RDB의 Table)

Relationship은 노드 간의 연결 (RDB의 FK와 달리 그 자체로 객체)

관계는 방향과 타입이 존재함 (예: (User)-[:LIKES]->(Post))

Property는 노드나 관계가 가지는 속성 (RDB의 Column)

2. Spring Data Neo4j (SDN) 설정
Spring Boot 연동 라이브러리

의존성 추가가 필요함 (spring-boot-starter-data-neo4j)

application.properties 파일에 URI, username, password 설정

3. 관계 모델링 (가장 중요)
관계를 명확히 만드는 핵심

두 가지 방법이 있음

방법 1: 간단한 관계 (관계에 속성 X)
관계 자체에 저장할 데이터가 없을 때 (예: 그냥 '팔로우' 여부)

노드 엔티티에서 바로 @Relationship 어노테이션 사용

필드 타입이 상대방 노드 자체가 됨

방법 2: 풍부한 관계 (관계에 속성 O) - 강력 추천
관계에 데이터를 저장해야 할 때 (예: '좋아요' 누른 시간)

이때는 관계를 별도의 클래스로 분리해야 함

소스 노드 (예: User)에서는 관계 속성 클래스(예: LikesRelationship)를 참조

관계 속성 클래스는 @RelationshipProperties 어노테이션을 가짐

이 클래스 안에 관계의 속성(예: likedAt)을 정의

그리고 @TargetNode 어노테이션을 사용해 목표 노드(예: Post)를 지정함

이렇게 하면 소스 노드가 관계 속성 클래스를 참조하고, 관계 속성 클래스가 목표 노드와 관계 속성을 모두 가지게 됨

4. Repository 및 데이터 저장
Neo4jRepository 인터페이스를 생성 (JPA와 비슷)

데이터를 저장할 때

방법 2 (풍부한 관계)의 경우

소스 노드와 타겟 노드를 찾음

관계 속성 클래스(예: LikesRelationship)의 인스턴스를 생성 (이때 타겟 노드와 관계 속성 값을 넣어줌)

소스 노드의 관계 Set에 이 인스턴스를 추가

소스 노드만 save 해도 SDN이 알아서

소스 노드, 타겟 노드, 그리고 그 사이의 관계(속성 포함)까지 생성/연결해줌

5. 요약
관계에 속성이 필요 없으면 @Relationship만

관계에 속성이 필요하면 (대부분의 경우) @RelationshipProperties 클래스를 따로 만들고 @TargetNode로 연결

저장은 Neo4jRepository의 save()를 믿고 사용