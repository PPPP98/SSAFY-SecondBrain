# TIL: 범용 검색을 위한 Elasticsearch 매핑 전략

---

## 고민

학습, 일상, 뉴스, 레시피 등 **모든 종류의 노트**를 하나의 매핑으로 어떻게 검색할까?

특정 도메인에 종속되면 안 됨. 유연하고 확장 가능해야 함

---

## -> 공통 요소에 집중

모든 노트가 가진 것: **제목과 본문**

이것만 검색하면 내용이 뭐든 찾아짐

---

## 핵심 필드 구조

**필수 검색 필드**
- title: 제목 (text, Nori 분석기)
- content: 본문 (text, Nori 분석기)
- user_id: 보안 필수 (keyword)

**선택 필터**
- tags: 태그 배열 (keyword)
- note_type: 학습/일상/뉴스 등 (keyword)
- created_at: 날짜 (date)

**확장 영역**
- custom_fields: 사용자 정의 필드 (동적)
- metadata: 검색 안 하는 추가 정보

---

## 검색 방식

**기본 검색**
"파이썬" → title과 content에서 찾음
- 학습 노트도 나옴
- 일상 노트도 나옴
- 레시피도 나옴 (김치찌개 파이썬 냄비로...)

**가중치**
- title: 3배
- content: 1배

**필터링 (선택)**
- "학습 노트에서만 파이썬 검색"
- "지난달 작성된 노트에서 검색"
- "프로그래밍 태그 있는 것만"

---

## 왜 user_id가 필수인가?

Elasticsearch는 **모든 사용자의 노트를 한 인덱스에** 저장함

user_id 필터 없으면 → 다른 사람 노트도 검색됨 (보안 사고)

**멀티테넌시 = user_id 필터 필수**

---

## Nori 분석기

한글 형태소 분석
- "극한의" → "극한"
- "극한은" → "극한"
- "극한이" → "극한"

"극한" 하나로 검색하면 위 셋 다 찾아짐

---

## 확장성

새 노트 타입 추가해도 매핑 변경 없음
- 운동 기록 추가? → note_type: "운동" 넣으면 끝
- 커스텀 필드 추가? → custom_fields에 넣으면 끝

Notion, Evernote도 이런 방식

---

## 핵심 원칙 3가지

1. **도메인 독립**: 특정 분야에 종속 X
2. **유연한 분류**: 태그/타입은 선택사항
3. **확장 가능**: 동적 필드 지원

---


**배운 점**: 범용 검색은 공통 요소(title, content)만 집중하면 됨. 분류는 부가 기능
